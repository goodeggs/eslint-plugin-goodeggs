dist: xenial

language: node_js
node_js:
  - 12.14.1

cache:
  yarn: true

env:
  global:
    - PATH="$HOME/.yarn/bin:$PATH"
    - YARN_VERSION="1.9.4"

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version "${YARN_VERSION}"

install: yarn install --frozen-lockfile

jobs:
  include:
    # Install dependencies and save them to the Travis cache
    - stage: "Prepare cache"
      # Don't run `script`, just install dependencies
      before_script: true
      script: true
    # Run tests
    - stage: "Test"
      name: "Lint"
      script:
      # Lint this package using this package. How meta.
      - yarn link
      - yarn link eslint-plugin-goodeggs
      - yarn run lint
    - name: "Unit Tests"
      script: yarn run test:unit
    - stage: "Publish to registry"
      if: tag =~ ^v
      script: skip
      deploy:
        provider: npm
        email: open-source@goodeggs.com
        api_token:
          secure: "TAgVve4BD+mnOINjw5zpWBu3VOGA+AoZ4Rj4uwzP8nBT2TUqkodmbbf6DY1Uv7bFD1opG+ABFXjqAxiJP9J4ItuImuUKJnh+iVEFXVU3CWWnXrCPalObH1jOnKr5T/YnWr502dbqanOarJBszqPmPHOewq4o2IjePDDhtKotxQKM7Dg5ATADL1s4+kMarzRuZ1ZFRF2sTnker3+n9FimbvFN/SujPJ4SFsNqBLrB3KhT09TvgsdWYjQn9UaH19oP8D4YUoFBVCoB9cikO4QfS8r9wMUivASlM+R3JH3bYaF8nnZI213+lkJ3TchcbN3tOAq/o0gubGnHccHgF+hSBi2ZlxS8PTb6tGpVW95MEVfy42510iTZsVlXEdymifzlJ+o5UtBHH4ZpyeeWZMoUrlokIDuLqYH9GycOHYwlckqkNr++dfSt1af1XPbEO3iufNSa9BO80oR+V/Cwo17c5FXGQGXvsCqniBwD9VPbJ8KMOydY2Ggn01NDG3/QBul2iajDgu/gtp2Tkwd7Ao/oK2XG/buNWYxAO+nRigy5snmrwPs9r0NjQyxO1RNjbyJBnFT+t1uIXvVDaDAyLFCBCkBSfFGBbFlTRBbPsgYmHy7o/OOUn3ifPXjCLjWfYlAvZVj2YbiCC7Kz9JkGdUe1sQBHvShfBO93C220C1X9T7Y="
        skip_cleanup: true
        on:
          tags: true
          all_branches: true
