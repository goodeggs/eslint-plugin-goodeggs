dist: xenial

language: node_js
node_js:
  - 12.14.1

cache:
  yarn: true

env:
  global:
    - PATH="$HOME/.yarn/bin:$PATH"
    - YARN_VERSION="1.9.4"
    # NPM_AUTH:
    - secure: "U2W+bHdiM84Y9zqYurTO8QVLUkXvc03bMplRZSz0CEBkgvvP8tV4iqf7gqajCov8tN7DcpddE7Vr/hNauZaAcJllejWpBWfvlSlYhFLyT8PgYX5SJGm4KREcTPY4ItjQDud/sFIpun6NFdJT/Azw+wL8f/AAH20sdFkTxdxT2SaD5hAOYI4nGve9OGqdyA+rXOHDDWFpz59eXte5SiOTOsjHxBGhW0fnPphlpwCxfvDOPrrNWJuZrKk/cR8xoHUMICBpVrtEfha7NPQlz5+P4DyJ7rWHLPKfvokxZGOouIVxZ5/35K/kLdsIM3bcnweXTqBsB7IrsEqGM+9Lay5/ITNRDyWdoHU+tbTRFA7JL9BAQgjG8MjWhAyTP/oTq9FHa9bg4z/lsPYaSUQJzFz7JEpPFOUaID7DTLSVksyy5e3sY8x8YV+jKvVMoJ3wachEm1wmfMnoYJZ7kQ206hpeZlJLwtcQ2Ja7AdjpwekHHMbw8eQXhohIgYo/aSWz+BKgwEeDGjFuQDclaPSUd1n+meyOUSVKrO8jT37rGz7a1m9gyBImU0ktJ/VdjUh3G0iSHwD/XJHHTONaMnFLkN5PJdbE/68OY/yD60o2BKS7hmT3eGkVuymbTDzcI2R3IL21xnWejZw2oVJGbpa01R2qKPhXGvwLBVK5vLMuoAvvv7k="

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version "${YARN_VERSION}"

install: yarn install --frozen-lockfile

jobs:
  include:
    # Install dependencies and save them to the Travis cache
    - stage: "Prepare cache"
      # Don't run `script`, just install dependencies
      before_script: true
      script: true
    # Run tests
    - stage: "Test"
      name: "Lint"
      script:
      # Lint this package using this package. How meta.
      - yarn link
      - yarn link eslint-plugin-goodeggs
      - yarn run lint
    - name: "Unit Tests"
      script: yarn run test:unit
    - stage: "Publish to registry"
      if: tag =~ ^v
      # script: echo "Publishing to npm registry..."
      deploy:
        provider: npm
        email: open-source@goodeggs.com
        api_key: $NPM_AUTH
        skip_cleanup: true
        on:
          tags: true
          all_branches: true
