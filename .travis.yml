dist: xenial

language: node_js
node_js:
  - 12.14.1

cache:
  yarn: true

env:
  global:
    - PATH="$HOME/.yarn/bin:$PATH"
    - YARN_VERSION="1.9.4"
    # NPM_AUTH:
    - secure: "nJwBi0gKKf6DCSH4/ihAwhudX0PPHc+cJLXf/Hwm59r97nahTVWrlz1XKdydQrosV2bBSged5YSNA0lBXMQbRPmWHKoUghUtizfJXrDA0Bb3Aly/GIZEA/x5vw0nwAgmgsSwhwtywThRBu94/KOCV+R9CQPDhSLPxjE3c9PbmSxMIn84q/k9kkrAhVBTDbG6mM3iQDf77aYYSQBl79VVrTjsDzG9zmIIbCwsnSOGyfay5CdfI2DvCdgRdq6iKKYYfCgq4BJTtXAEF9PWirjB5yLV0xLE+j4LLBNFCiNoc2a6YI+lSy2E70rZ3m0LcPjs/5mnfz6dW3GWDmxvNrrckaxYlKR9c2FM+xgzJ+SFxIosSHARgJbZKMUgv5/S+MH0nY5R09TuWOc+svpxfWHgs+yh624jkzBkVAyNwN8679zufcsuQJMpKQcUybmb8QLxEDyAt720ffM+kQuhK/oTqvnyKXXXR2fb5Wnru53/mZm2aIAZOCXWHV4Ozw2V4V7ydsAo5+vVmzNUZGFO1uP3yIHZ4EV5i5ljfRVGV/8tc0HDJMfAr2cTl91BBW+oshPY9K2dML32oE3JoQq9nAv4PptKrWFhkzDpw7ToCX8IltevOUTPTLwrpSJQuzWWQIJecDOBsNkYehPDOPTFyL+IBNNd6Uq/6koBZvxB5Z88NZQ="

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version "${YARN_VERSION}"

install: yarn install --frozen-lockfile

jobs:
  include:
    # Install dependencies and save them to the Travis cache
    - stage: "Prepare cache"
      # Don't run `script`, just install dependencies
      before_script: true
      script: true
    # Run tests
    - stage: "Test"
      name: "Lint"
      script:
      # Lint this package using this package. How meta.
      - yarn link
      - yarn link eslint-plugin-goodeggs
      - yarn run lint
    - name: "Unit Tests"
      script: yarn run test:unit
    - stage: "Publish to registry"
      if: tag =~ ^v
      script: echo "Publishing to npm registry..."
      deploy:
        provider: script
        script: yarn publish
        skip_cleanup: true
        on:
          tags: true
          all_branches: true
