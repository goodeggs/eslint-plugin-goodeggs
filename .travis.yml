dist: xenial

language: node_js
node_js:
  - 12.14.1

cache:
  yarn: true

env:
  global:
    - PATH="$HOME/.yarn/bin:$PATH"
    - YARN_VERSION="1.9.4"
    # NODE_ENV:
    - secure: "Wwy62drIkDa672XDza/utg26DYTnxcsHrxpswa000kMnAJo2avFqO7Mhefg4HC3lwyjfHX9FiYGF/Vfa4GqIUU91sytXqr03or30BG2BJYXQKsdAPCuO7VpN70Cqp7/rI5V7dOFg3YS5ONptx6fW3NrEqmi1uc8VPWqppkfqHzQgf+1VKj5mdlNfas8LiXVtY9i/CW9zISZHAA5pT31RsTESL4YHZWxSADzOF56PgHgt4KHnR4n1Pfnptnc+vW+Kk4LhAJU7KgeVAHOQIpEyLEWepasCryjTQxqoNHfs1lbCJGoifcUmdupEZh5kLmNDrSrkCnFBwhZkl9r/WdP5zQnr73F1iUxN81zZBXe81FHYvd3RzRkO6iUd+e1IXvifp0hRWGQWCQDjWsNNrRb2PhGAbQx0vYTfm86WfwvtS0WpW9014QBFa7IFqM7fgzQGQExxKtd3yxQ5n2/NaueVRZIREdSHx+AXbcLAEC4L4nP52pbtYfJg2D8+TH9UNiY4EFZTtjt7LizLynEe2jetfjkopEGAhqphWTa3QgU/xM4gBJWWlVA/NuIj64WCLujDR6ov8QiezYbp6EF2ffLXJHMYv5bvpgbAs3vgeORU0gfKSHcf2HEyoU4NHoZia9slN79OCZapVcy2MLd9Kr5g6PQdyL9tA6b7Fxsvys0M4aw="

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version "${YARN_VERSION}"

install: yarn install --frozen-lockfile

jobs:
  include:
    # Install dependencies and save them to the Travis cache
    - stage: "Prepare cache"
      # Don't run `script`, just install dependencies
      before_script: true
      script: true
    # Run tests
    - stage: "Test"
      name: "Lint"
      script:
      # Lint this package using this package. How meta.
      - yarn link
      - yarn link eslint-plugin-goodeggs
      - yarn run lint
    - name: "Unit Tests"
      script: yarn run test:unit
    - stage: "Publish to registry"
      if: tag =~ ^v
      script: echo "Publishing to npm registry..."
      deploy:
        provider: script
        script: NPM_CONFIG_USERCONFIG=.publish.npmrc yarn publish
        skip_cleanup: true
        on:
          tags: true
          all_branches: true
